<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AI Blog Content Generator</title>
		<!-- Tailwind CSS CDN -->
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- Inter font from Google Fonts -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			body {
				font-family: "Inter", sans-serif;
				-webkit-font-smoothing: antialiased;
				-moz-osx-font-smoothing: grayscale;
			}
			/* Custom spinner for loading states */
			.spinner {
				border: 4px solid rgba(255, 255, 255, 0.3);
				border-top: 4px solid #38bdf8; /* Tailwind sky-400 */
				border-radius: 50%;
				width: 24px;
				height: 24px;
				animation: spin 1s linear infinite;
			}
			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
			/* Markdown styling for generated blog post */
			.markdown-content h1 {
				font-size: 2.25rem; /* 3xl */
				font-weight: 700; /* bold */
				margin-top: 2rem;
				margin-bottom: 1rem;
				color: #60a5fa; /* blue-400 */
			}
			.markdown-content h2 {
				font-size: 1.875rem; /* 2xl */
				font-weight: 600; /* semibold */
				margin-top: 1.5rem;
				margin-bottom: 0.75rem;
				color: #60a5fa; /* blue-400 */
			}
			.markdown-content h3 {
				font-size: 1.5rem; /* xl */
				font-weight: 600;
				margin-top: 1.25rem;
				margin-bottom: 0.5rem;
				color: #93c5fd; /* blue-300 */
			}
			.markdown-content p {
				margin-bottom: 1rem;
				line-height: 1.75; /* leading-relaxed */
			}
			.markdown-content ul,
			.markdown-content ol {
				list-style-position: inside;
				margin-bottom: 1rem;
				padding-left: 1.5rem;
			}
			.markdown-content ul {
				list-style-type: disc;
			}
			.markdown-content ol {
				list-style-type: decimal;
			}
			.markdown-content li {
				margin-bottom: 0.5rem;
			}
			.markdown-content strong {
				font-weight: 700; /* bold */
				color: #a78bfa; /* violet-400 */
			}
			.markdown-content a {
				color: #38bdf8; /* sky-400 */
				text-decoration: underline;
			}
			.markdown-content blockquote {
				border-left: 4px solid #60a5fa;
				padding-left: 1rem;
				margin-left: 0;
				margin-bottom: 1rem;
				color: #94a3b8; /* slate-400 */
				font-style: italic;
			}
			.markdown-content code {
				background-color: #334155; /* slate-700 */
				padding: 0.25rem 0.5rem;
				border-radius: 0.25rem;
				font-family: monospace;
				font-size: 0.875em;
			}
			.markdown-content pre {
				background-color: #1e293b; /* slate-800 */
				padding: 1rem;
				border-radius: 0.5rem;
				overflow-x: auto;
				margin-bottom: 1rem;
			}
		</style>
	</head>
	<body class="min-h-screen bg-slate-900 text-slate-200">
		<div id="root" class="min-h-screen">
			<!-- Header -->
			<header class="bg-gradient-to-r from-purple-600 to-sky-500 p-6 shadow-xl">
				<div
					class="container mx-auto flex flex-col sm:flex-row justify-between items-center"
				>
					<h1 class="text-3xl font-bold text-white mb-4 sm:mb-0">
						AI Blog Content Generator
					</h1>
					<p class="text-white text-opacity-80">Powered by Google Gemini AI</p>
				</div>
			</header>

			<main class="container mx-auto p-4 md:p-8">
				<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
					<!-- Left Column: Controls -->
					<aside class="lg:col-span-1 space-y-6">
						<div
							class="bg-slate-800/50 p-6 rounded-xl shadow-lg border border-slate-700"
						>
							<h2 class="text-xl font-bold text-sky-400 mb-4">
								1. Start with a Topic
							</h2>
							<p class="text-slate-400 mb-4 text-sm">
								Enter a keyword or a full topic to get started.
							</p>
							<input
								type="text"
								id="topicInput"
								placeholder="e.g., 'The Future of AI'"
								class="w-full bg-slate-700 border border-slate-600 rounded-md px-4 py-2 focus:ring-2 focus:ring-sky-500 focus:outline-none transition placeholder-slate-400 text-slate-200"
							/>
						</div>

						<div
							class="bg-slate-800/50 p-6 rounded-xl shadow-lg border border-slate-700"
						>
							<h2 class="text-xl font-bold text-sky-400 mb-4">
								2. Generate Content
							</h2>
							<div class="space-y-4">
								<!-- Action Button for Ideas -->
								<button
									id="generateIdeasBtn"
									class="action-button w-full flex items-center justify-center gap-2 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
								>
									<svg
										class="w-5 h-5"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M9.663 17h4.673M12 17v5m6.44-4.14L21 21M9.663 17a4.998 4.998 0 01-2.457-3.75 5 5 0 01.127-1.733M9.663 17h4.673M12 17v5m6.44-4.14L21 21M9.663 17a4.998 4.998 0 01-2.457-3.75 5 5 0 01.127-1.733M12 21.75a.75.75 0 00.75-.75h-.75V21h.75a.75.75 0 00-.75-.75v-.75a.75.75 0 00-.75.75h-.75V21h.75a.75.75 0 00-.75.75v.75zm0 0c.34-.047.653-.16.924-.315l-.76-.76a1.125 1.125 0 01-.164-.263l-.066-.145m-.385.195l-.184.184m.184-.184l-.184.184M3 21h18M12 3a.75.75 0 00-.75.75v-.75h-.75V3a.75.75 0 00-.75.75v.75h-.75V3a.75.75 0 00-.75.75v.75M3.75 3h.75v.75h-.75V3zm16.5 0h.75v.75h-.75V3z"
										></path>
									</svg>
									<span>Generate Blog Ideas</span>
								</button>
								<!-- Action Button for Post -->
								<button
									id="writePostBtn"
									class="action-button w-full flex items-center justify-center gap-2 px-6 py-3 bg-sky-600 hover:bg-sky-700 text-white font-semibold rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
								>
									<svg
										class="w-5 h-5"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
										></path>
									</svg>
									<span>Write Full Post</span>
								</button>
								<!-- Action Button for Image -->
								<button
									id="generateImageBtn"
									class="action-button w-full flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
								>
									<svg
										class="w-5 h-5"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
										></path>
									</svg>
									<span>Create Header Image</span>
								</button>
							</div>
						</div>

						<!-- Error Display -->
						<div
							id="errorDisplay"
							class="hidden bg-red-500/20 border border-red-500 text-red-300 p-4 rounded-lg"
							role="alert"
						>
							<p class="font-bold">Error</p>
							<p id="errorMessage" class="text-sm"></p>
						</div>

						<!-- Idea List Display -->
						<div
							id="ideaListContainer"
							class="hidden bg-slate-800/50 p-6 rounded-xl shadow-lg border border-slate-700"
						>
							<h3 class="text-lg font-semibold text-purple-400 mb-3">
								Generated Ideas:
							</h3>
							<div id="ideaList" class="space-y-2">
								<!-- Ideas will be dynamically inserted here -->
							</div>
						</div>
					</aside>

					<!-- Right Column: Output -->
					<div
						class="lg:col-span-2 bg-slate-800/50 p-4 sm:p-6 md:p-8 rounded-xl shadow-lg border border-slate-700 min-h-[500px] flex flex-col justify-center items-center"
					>
						<!-- Loader Display -->
						<div id="loader" class="hidden text-center">
							<div class="spinner mx-auto mb-4"></div>
							<p id="loaderText" class="text-xl text-sky-400 font-semibold">
								Loading...
							</p>
						</div>

						<!-- Welcome/Placeholder Message -->
						<div
							id="welcomeMessage"
							class="flex flex-col items-center justify-center h-full text-center text-slate-500 p-4"
						>
							<h2 class="text-2xl font-bold">Your content will appear here</h2>
							<p class="mt-2 text-base">
								Use the controls on the left to generate ideas, write a post, or
								create an image.
							</p>
						</div>

						<!-- Image Display -->
						<div
							id="imageDisplayContainer"
							class="hidden w-full h-auto mb-6 rounded-lg overflow-hidden shadow-lg"
						>
							<img
								id="generatedImage"
								src=""
								alt="Generated Blog Header"
								class="w-full h-full object-cover rounded-lg"
								onerror="this.onerror=null; this.src='https://placehold.co/800x450/334155/64748b?text=Image+Load+Error';"
							/>
						</div>

						<!-- Blog Post Display -->
						<div
							id="blogDisplayContainer"
							class="hidden w-full markdown-content text-slate-300"
						>
							<!-- Blog post content will be inserted here -->
						</div>
					</div>
				</div>
			</main>
		</div>

		<script>
			// DOM Elements
			const topicInput = document.getElementById("topicInput");
			const generateIdeasBtn = document.getElementById("generateIdeasBtn");
			const writePostBtn = document.getElementById("writePostBtn");
			const generateImageBtn = document.getElementById("generateImageBtn");
			const errorDisplay = document.getElementById("errorDisplay");
			const errorMessage = document.getElementById("errorMessage");
			const ideaListContainer = document.getElementById("ideaListContainer");
			const ideaList = document.getElementById("ideaList");
			const loader = document.getElementById("loader");
			const loaderText = document.getElementById("loaderText");
			const welcomeMessage = document.getElementById("welcomeMessage");
			const imageDisplayContainer = document.getElementById(
				"imageDisplayContainer"
			);
			const generatedImageElem = document.getElementById("generatedImage");
			const blogDisplayContainer = document.getElementById(
				"blogDisplayContainer"
			);

			const API_BASE_URL = "http://localhost:3000/api/googleGenAI"; // Ensure this matches your Node.js server port

			let isLoading = false; // Flag to manage overall loading state

			// Utility function to set loading state
			function setLoading(activeTask, text = "Loading...") {
				isLoading = true;
				topicInput.disabled = true;
				generateIdeasBtn.disabled = true;
				writePostBtn.disabled = true;
				generateImageBtn.disabled = true;

				welcomeMessage.classList.add("hidden");
				imageDisplayContainer.classList.add("hidden");
				blogDisplayContainer.classList.add("hidden");
				ideaListContainer.classList.add("hidden");
				errorDisplay.classList.add("hidden");

				loader.classList.remove("hidden");
				loaderText.textContent = text;
			}

			// Utility function to clear loading state
			function clearLoading() {
				isLoading = false;
				topicInput.disabled = false;
				generateIdeasBtn.disabled = false;
				writePostBtn.disabled = false;
				generateImageBtn.disabled = false;
				loader.classList.add("hidden");

				// Show welcome message if no content is displayed
				if (
					blogDisplayContainer.classList.contains("hidden") &&
					imageDisplayContainer.classList.contains("hidden") &&
					ideaListContainer.classList.contains("hidden")
				) {
					welcomeMessage.classList.remove("hidden");
				}
			}

			// Utility function to display error
			function displayError(message) {
				setError(message); // Use the existing setError function
			}

			function setError(message) {
				errorMessage.textContent = message;
				errorDisplay.classList.remove("hidden");
				welcomeMessage.classList.add("hidden"); // Hide welcome message on error
			}

			function clearContent() {
				blogDisplayContainer.innerHTML = "";
				generatedImageElem.src = "";
				ideaList.innerHTML = "";
				welcomeMessage.classList.remove("hidden");
				imageDisplayContainer.classList.add("hidden");
				blogDisplayContainer.classList.add("hidden");
				ideaListContainer.classList.add("hidden");
				errorDisplay.classList.add("hidden");
			}

			// --- Event Handlers ---

			generateIdeasBtn.addEventListener("click", async () => {
				const topic = topicInput.value.trim();
				if (!topic) {
					setError("Please enter a topic first.");
					return;
				}
				clearContent(); // Clear previous content
				setLoading("IDEAS", "Brainstorming ideas...");
				try {
					const response = await fetch(`${API_BASE_URL}/generate-ideas`, {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ topic }),
					});
					const data = await response.json();

					if (response.ok) {
						displayIdeas(data.ideas || []);
					} else {
						setError(data.error || "Failed to generate blog ideas.");
					}
				} catch (e) {
					setError(
						"Network error or server unreachable. Is the Node.js API running?"
					);
					console.error("Error generating ideas:", e);
				} finally {
					clearLoading();
				}
			});

			writePostBtn.addEventListener("click", async () => {
				const topic = topicInput.value.trim();
				if (!topic) {
					setError("Please select or enter a topic first.");
					return;
				}
				clearContent(); // Clear previous content
				setLoading("POST", "Writing your masterpiece...");
				try {
					const response = await fetch(`${API_BASE_URL}/write-post`, {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ topic }),
					});
					const data = await response.json();

					if (response.ok) {
						displayBlogPost(data.post || "");
					} else {
						setError(data.error || "Failed to write blog post.");
					}
				} catch (e) {
					setError(
						"Network error or server unreachable. Is the Node.js API running?"
					);
					console.error("Error writing post:", e);
				} finally {
					clearLoading();
				}
			});

			generateImageBtn.addEventListener("click", async () => {
				const topic = topicInput.value.trim();
				if (!topic) {
					setError("Please have a topic before generating an image.");
					return;
				}
				clearContent(); // Clear previous content
				setLoading("IMAGE", "Creating a stunning visual...");
				try {
					const response = await fetch(`${API_BASE_URL}/generate-image`, {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ prompt: topic }), // API expects 'prompt'
					});
					const data = await response.json();

					if (response.ok) {
						displayImage(data.imageUrl || null);
					} else {
						setError(data.error || "Failed to generate image.");
					}
				} catch (e) {
					setError(
						"Network error or server unreachable. Is the Node.js API running?"
					);
					console.error("Error generating image:", e);
				} finally {
					clearLoading();
				}
			});

			// --- Display Functions ---

			function displayIdeas(ideas) {
				ideaList.innerHTML = ""; // Clear previous ideas
				if (ideas && ideas.length > 0) {
					ideas.forEach((idea, index) => {
						const ideaItem = document.createElement("button");
						ideaItem.className =
							"idea-item w-full text-left px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed text-slate-200";
						ideaItem.textContent = idea;
						ideaItem.onclick = () => selectIdeaAsTopic(idea);
						ideaItem.disabled = isLoading; // Disable if loading another task
						ideaList.appendChild(ideaItem);
					});
					ideaListContainer.classList.remove("hidden");
					welcomeMessage.classList.add("hidden"); // Hide welcome
				} else {
					ideaListContainer.classList.add("hidden");
					welcomeMessage.classList.remove("hidden"); // Show welcome if no ideas
				}
			}

			function displayBlogPost(content) {
				if (content) {
					// For a robust markdown display, you'd integrate a markdown parser library
					// For simplicity, we're just setting innerHTML, which might not render all markdown perfectly
					// A better approach would be to use a library like 'marked.js' or 'dompurify'
					blogDisplayContainer.innerHTML = content;
					blogDisplayContainer.classList.remove("hidden");
					welcomeMessage.classList.add("hidden");
				} else {
					blogDisplayContainer.classList.add("hidden");
					welcomeMessage.classList.remove("hidden");
				}
			}

			function displayImage(imageUrl) {
				if (imageUrl) {
					generatedImageElem.src = imageUrl;
					imageDisplayContainer.classList.remove("hidden");
					welcomeMessage.classList.add("hidden");
				} else {
					imageDisplayContainer.classList.add("hidden");
					welcomeMessage.classList.remove("hidden");
				}
			}

			// --- Other Logic ---

			function selectIdeaAsTopic(idea) {
				topicInput.value = idea;
				clearContent(); // Clear existing results when a new topic is selected
			}

			// Initial state on load
			document.addEventListener("DOMContentLoaded", () => {
				clearLoading(); // Ensure buttons are enabled initially
				welcomeMessage.classList.remove("hidden"); // Ensure welcome message is visible
			});
		</script>
	</body>
</html>
