<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Admin Dashboard</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- Chart.js for Analytics -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<!-- Quill Rich Text Editor -->
		<link
			href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
			rel="stylesheet"
		/>
		<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

		<style>
			/* Custom styles for the dashboard */
			::-webkit-scrollbar {
				width: 8px;
			}
			::-webkit-scrollbar-track {
				background: #f1f1f1;
			}
			::-webkit-scrollbar-thumb {
				background: #888;
				border-radius: 4px;
			}
			::-webkit-scrollbar-thumb:hover {
				background: #555;
			}
			.sidebar-link.active {
				background-color: #3b82f6;
				color: white;
			}
			.sidebar-link {
				transition: background-color 0.2s ease-in-out;
			}
			.sidebar-link:hover {
				background-color: #374151;
			}

			/* Quill Editor Styling */
			#editor-container {
				height: 300px;
				background-color: white;
			}
			.ql-toolbar.ql-snow {
				border-top-left-radius: 0.375rem;
				border-top-right-radius: 0.375rem;
				border-color: #d1d5db;
			}
			.ql-container.ql-snow {
				border-bottom-left-radius: 0.375rem;
				border-bottom-right-radius: 0.375rem;
				border-color: #d1d5db;
			}

			/* Responsive Sidebar */
			@media (max-width: 1023px) {
				#sidebar {
					transform: translateX(-100%);
					position: fixed;
					height: 100%;
					z-index: 50;
					transition: transform 0.3s ease-in-out;
				}
				#sidebar.open {
					transform: translateX(0);
				}
				#overlay {
					display: none;
					position: fixed;
					inset: 0;
					background-color: rgba(0, 0, 0, 0.5);
					z-index: 40;
				}
				#overlay.active {
					display: block;
				}
			}

			/* AI Assistant Loader */
			.spinner {
				width: 24px;
				height: 24px;
				border: 3px solid rgba(255, 255, 255, 0.3);
				border-radius: 50%;
				border-top-color: #fff;
				animation: spin 1s ease-in-out infinite;
			}
			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}
		</style>
	</head>
	<body class="bg-gray-100 font-sans">
		<!-- Login Screen (Now hidden by default for testing) -->
		<div id="login-screen" class="hidden items-center justify-center h-screen">
			<div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-sm">
				<h2 class="text-2xl font-bold mb-6 text-center">Admin Login</h2>
				<form id="login-form">
					<div class="mb-4">
						<label for="username" class="block text-gray-700 mb-2"
							>Username</label
						>
						<input
							type="text"
							id="username"
							class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
							required
						/>
					</div>
					<div class="mb-6">
						<label for="password" class="block text-gray-700 mb-2"
							>Password</label
						>
						<input
							type="password"
							id="password"
							class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
							required
						/>
					</div>
					<button
						type="submit"
						id="login-button"
						class="w-full bg-blue-500 text-white font-bold py-3 rounded-md hover:bg-blue-600 transition-colors disabled:bg-blue-300"
					>
						Login
					</button>
					<p id="login-error" class="text-red-500 text-center mt-4 h-5"></p>
				</form>
			</div>
		</div>

		<!-- Main Dashboard UI -->
		<div id="dashboard-ui" class="hidden h-screen bg-gray-200">
			<div class="flex h-full relative">
				<div id="overlay" class="hidden lg:hidden"></div>
				<!-- Sidebar -->
				<div
					id="sidebar"
					class="w-64 bg-gray-800 text-white p-5 flex-shrink-0 flex flex-col"
				>
					<div class="text-2xl font-bold mb-10">Admin Panel</div>
					<nav>
						<a
							href="#dashboard"
							class="sidebar-link active flex items-center py-3 px-4 rounded"
							>Dashboard</a
						>
						<a
							href="#blogs"
							class="sidebar-link flex items-center py-3 px-4 rounded mt-2"
							>Blogs</a
						>
						<a
							href="#media"
							class="sidebar-link flex items-center py-3 px-4 rounded mt-2"
							>Media</a
						>
					</nav>
					<button
						id="logout-button"
						class="mt-auto flex items-center py-3 px-4 rounded text-red-400 hover:bg-red-500 hover:text-white transition-colors"
					>
						Logout
					</button>
				</div>

				<!-- Main Content -->
				<div class="flex-1 flex flex-col overflow-hidden">
					<header class="bg-white shadow-sm p-4 flex items-center">
						<button
							id="mobile-menu-button"
							class="lg:hidden text-gray-600 mr-4 focus:outline-none"
						>
							<svg
								class="w-6 h-6"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M4 6h16M4 12h16M4 18h16"
								></path>
							</svg>
						</button>
						<h1 id="page-title" class="text-2xl font-semibold text-gray-800">
							Dashboard
						</h1>
					</header>
					<main
						class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6"
					>
						<!-- Dashboard Content -->
						<div id="dashboard-content" class="content-panel">
							<div class="bg-white p-6 rounded-lg shadow-md">
								<h3 class="text-xl font-semibold mb-4">
									Site Visitors (Last 7 Days)
								</h3>
								<div class="h-80"><canvas id="visitorsChart"></canvas></div>
							</div>
						</div>
						<!-- Blogs Content -->
						<div id="blogs-content" class="content-panel hidden">
							<div class="bg-white p-6 rounded-lg shadow-md mb-6">
								<h3 id="blog-form-title" class="text-xl font-semibold mb-4">
									Write a New Blog Post
								</h3>
								<form id="blog-form">
									<input type="hidden" id="blog-id" />
									<div class="mb-4">
										<label for="blog-title" class="block mb-1 font-medium"
											>Title</label
										>
										<input
											type="text"
											id="blog-title"
											placeholder="Post Title"
											class="w-full p-3 border border-gray-300 rounded-md"
											required
										/>
									</div>

									<!-- AI Assistant Section -->
									<div
										class="bg-gray-50 border border-gray-200 p-4 rounded-lg mb-4"
									>
										<div class="flex items-center gap-2 mb-3">
											<svg
												xmlns="http://www.w3.org/2000/svg"
												class="h-6 w-6 text-purple-500"
												fill="none"
												viewBox="0 0 24 24"
												stroke="currentColor"
											>
												<path
													stroke-linecap="round"
													stroke-linejoin="round"
													stroke-width="2"
													d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M6.343 18.657l-.707.707m12.728 0l-.707-.707M6.343 5.657l-.707-.707m12.728 0l.707.707M4 12H3m18 0h-1m-5.636 6.364l-.707-.707M12 21v-1m-6.364-1.636l.707-.707"
												/>
											</svg>
											<h4 class="text-lg font-semibold text-gray-700">
												AI Assistant
											</h4>
										</div>
										<label
											for="ai-topic"
											class="block text-sm font-medium text-gray-600 mb-1"
											>Topic or Keyword</label
										>
										<input
											type="text"
											id="ai-topic"
											placeholder="e.g., 'Career growth strategies for nurses'"
											class="w-full p-2 border border-gray-300 rounded-md mb-3"
										/>
										<div class="flex flex-col sm:flex-row gap-3">
											<button
												type="button"
												id="generate-titles-btn"
												class="flex-1 bg-purple-500 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-600 flex items-center justify-center gap-2 transition disabled:bg-purple-300"
											>
												Generate Titles
											</button>
											<button
												type="button"
												id="generate-post-btn"
												class="flex-1 bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 flex items-center justify-center gap-2 transition disabled:bg-blue-300"
											>
												Write Full Post
											</button>
										</div>
										<div id="ai-loader" class="hidden text-center mt-3">
											<div class="spinner inline-block"></div>
											<span class="ml-2 text-gray-600">Generating...</span>
										</div>
										<div id="title-suggestions" class="mt-4 space-y-2"></div>
									</div>

									<div class="mb-4">
										<label class="block mb-1 font-medium">Content</label>
										<div id="editor-container"></div>
									</div>
									<div class="flex items-center gap-4 mt-10">
										<button
											type="submit"
											id="blog-submit-button"
											class="bg-blue-500 text-white font-bold py-2 px-6 rounded-md hover:bg-blue-600"
										>
											Publish Post
										</button>
										<button
											type="button"
											id="blog-cancel-button"
											class="hidden bg-gray-500 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-600"
										>
											Cancel
										</button>
									</div>
								</form>
							</div>
							<div class="bg-white p-6 rounded-lg shadow-md mt-6">
								<h3 class="text-xl font-semibold mb-4">
									Manage Existing Posts
								</h3>
								<div class="overflow-x-auto">
									<table class="w-full text-left">
										<thead>
											<tr class="border-b">
												<th class="p-2">Title</th>
												<th class="p-2 hidden sm:table-cell">Date</th>
												<th class="p-2">Actions</th>
											</tr>
										</thead>
										<tbody id="blog-list"></tbody>
									</table>
								</div>
							</div>
						</div>
						<!-- Media Content -->
						<div id="media-content" class="content-panel hidden">
							<div class="bg-white p-6 rounded-lg shadow-md">
								<h3 class="text-xl font-semibold mb-4">Upload New Media</h3>
								<form id="imageUploadForm" class="flex flex-col items-center">
									<input
										type="file"
										id="imageFileInput"
										name="image"
										accept="image/*"
										required
										class="hidden"
									/>
									<div
										id="imagePreviewContainer"
										class="mb-4 mt-2 p-4 w-full md:w-3/4 lg:w-1/2 h-64 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 flex flex-col justify-center items-center text-center cursor-pointer transition-colors duration-200 hover:border-blue-400 hover:bg-blue-50 overflow-hidden"
									>
										<img
											id="imagePreview"
											src=""
											alt="Image Preview"
											class="max-w-full max-h-full object-contain hidden"
										/>
										<p
											id="imagePreviewPlaceholder"
											class="text-gray-500 text-sm"
										>
											Drag & drop an image here, or click to select a file.
										</p>
										<p
											id="imageFileName"
											class="text-xs text-gray-700 hidden mt-1"
										></p>
									</div>
									<button
										type="submit"
										id="upload-button"
										class="hidden bg-green-500 text-white font-bold py-2 px-4 rounded-md hover:bg-green-600 disabled:bg-green-300"
									>
										Upload
									</button>
								</form>
							</div>
							<div class="bg-white p-6 rounded-lg shadow-md mt-6">
								<h3 class="text-xl font-semibold mb-4">Manage Media</h3>
								<div
									id="media-grid"
									class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
								></div>
							</div>
						</div>
					</main>
				</div>
			</div>
		</div>
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				// --- CONFIG ---
				const API_URL = "https://amy-s-blog-backend.onrender.com/api";

				// --- DOM Elements ---
				const loginScreen = document.getElementById("login-screen");
				const dashboardUI = document.getElementById("dashboard-ui");
				const loginForm = document.getElementById("login-form");
				const logoutButton = document.getElementById("logout-button");
				let visitorsChart;
				let quill;

				// --- Mobile Menu Elements ---
				const mobileMenuButton = document.getElementById("mobile-menu-button");
				const sidebar = document.getElementById("sidebar");
				const overlay = document.getElementById("overlay");

				// --- AI Assistant Elements ---
				const aiTopicInput = document.getElementById("ai-topic");
				const generateTitlesBtn = document.getElementById(
					"generate-titles-btn"
				);
				const generatePostBtn = document.getElementById("generate-post-btn");
				const titleSuggestions = document.getElementById("title-suggestions");
				const aiLoader = document.getElementById("ai-loader");

				// --- API Helper ---
				const api = {
					async request(endpoint, options = {}) {
						try {
							const response = await fetch(`${API_URL}${endpoint}`, {
								credentials: "include",
								...options,
							});

							if (response.status === 401) {
								auth.logout();
								return {
									ok: false,
									data: { msg: "Session expired. Please log in again." },
								};
							}

							const contentType = response.headers.get("content-type");
							if (
								!response.ok ||
								!contentType ||
								!contentType.includes("application/json")
							) {
								const textData = await response.text();
								console.error(
									"Non-JSON or error response from server:",
									textData
								);
								return {
									ok: false,
									status: response.status,
									data: {
										msg:
											textData || `Server returned status ${response.status}`,
									},
								};
							}

							const data = await response.json();
							return { ok: response.ok, status: response.status, data };
						} catch (error) {
							console.error(`API request to ${endpoint} failed:`, error);
							return {
								ok: false,
								data: {
									msg: "Network Error: Could not connect to the server.",
								},
							};
						}
					},
					get(endpoint) {
						return this.request(endpoint);
					},
					post(endpoint, body) {
						return this.request(endpoint, {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(body),
						});
					},
					put(endpoint, body) {
						return this.request(endpoint, {
							method: "PUT",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(body),
						});
					},
					del(endpoint) {
						return this.request(endpoint, { method: "DELETE" });
					},
					upload(endpoint, formData) {
						return this.request(endpoint, {
							method: "POST",
							body: formData,
						});
					},
				};

				// --- Authentication ---
				const auth = {
					async login(username, password) {
						const response = await api.post("/auth/login", {
							username,
							password,
						});
						if (response.ok) {
							this.showDashboard();
						} else {
							document.getElementById("login-error").textContent =
								response.data.msg || `Error: ${response.status}`;
						}
					},
					async logout() {
						await api.post("/auth/logout");
						loginScreen.style.display = "flex";
						dashboardUI.style.display = "none";
					},
					async check() {
						const response = await api.get("/auth/status");
						if (response.ok && response.data.loggedIn) {
							this.showDashboard();
						} else {
							loginScreen.style.display = "flex";
							dashboardUI.style.display = "none";
							if (!response.ok) {
								document.getElementById("login-error").textContent =
									response.data.msg;
							}
						}
					},
					showDashboard() {
						loginScreen.style.display = "none";
						dashboardUI.style.display = "block";
						initDashboard();
					},
				};

				loginForm.addEventListener("submit", (e) => {
					e.preventDefault();
					auth.login(
						document.getElementById("username").value,
						document.getElementById("password").value
					);
				});
				logoutButton.addEventListener("click", () => auth.logout());

				mobileMenuButton.addEventListener("click", () => {
					sidebar.classList.toggle("open");
					overlay.classList.toggle("active");
				});
				overlay.addEventListener("click", () => {
					sidebar.classList.remove("open");
					overlay.classList.remove("active");
				});

				// --- Dashboard Initialization ---
				const initDashboard = () => {
					initializeQuillEditor();
					loadAnalytics();
					loadBlogPosts();
					setupNavigation();
					setupBlogForm();
					setupMediaManagement();
					setupAIAssistant();
				};

				// --- AI Assistant Logic ---
				function setupAIAssistant() {
					generateTitlesBtn.addEventListener("click", handleGenerateTitles);
					generatePostBtn.addEventListener("click", handleGeneratePost);
				}

				async function callGeminiAPI(prompt, isJson = false) {
					aiLoader.classList.remove("hidden");
					[generateTitlesBtn, generatePostBtn].forEach(
						(btn) => (btn.disabled = true)
					);

					try {
						let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
						const payload = { contents: chatHistory };

						if (isJson) {
							payload.generationConfig = {
								responseMimeType: "application/json",
								responseSchema: {
									type: "OBJECT",
									properties: {
										titles: { type: "ARRAY", items: { type: "STRING" } },
									},
								},
							};
						}

						const apiKey = "";
						const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

						const response = await fetch(apiUrl, {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(payload),
						});

						if (!response.ok)
							throw new Error(`API error! status: ${response.status}`);

						const result = await response.json();
						return result.candidates[0].content.parts[0].text;
					} catch (error) {
						console.error("Gemini API Error:", error);
						alert(
							"Failed to generate content from AI. Please check the console for details."
						);
						return null;
					} finally {
						aiLoader.classList.add("hidden");
						[generateTitlesBtn, generatePostBtn].forEach(
							(btn) => (btn.disabled = false)
						);
					}
				}

				function simpleMarkdownToHtml(markdown) {
					if (!markdown) return "";
					return markdown
						.replace(/^### (.*$)/gim, "<h3>$1</h3>")
						.replace(/^## (.*$)/gim, "<h2>$1</h2>")
						.replace(/^# (.*$)/gim, "<h1>$1</h1>")
						.replace(/\*\*(.*?)\*\*/gim, "<strong>$1</strong>")
						.replace(/\*(.*?)\*/gim, "<em>$1</em>")
						.replace(/^\s*\n\*/gm, "<ul>\n*")
						.replace(/^(\*.+)\s*\n([^*])/gm, "$1\n</ul>\n$2")
						.replace(/^\* (.*$)/gim, "<li>$1</li>")
						.replace(/\n/g, "<br />");
				}

				async function handleGenerateTitles() {
					const topic = aiTopicInput.value.trim();
					if (!topic) {
						alert("Please enter a topic first.");
						return;
					}
					const prompt = `Generate 5 creative and engaging blog post titles for the topic: "${topic}". Return the titles as a JSON object with a single key "titles" which is an array of strings.`;
					const result = await callGeminiAPI(prompt, true);

					if (result) {
						try {
							const parsed = JSON.parse(result);
							titleSuggestions.innerHTML = "";
							parsed.titles.forEach((title) => {
								const button = document.createElement("button");
								button.type = "button";
								button.textContent = title;
								button.className =
									"w-full text-left p-2 bg-gray-200 hover:bg-blue-200 rounded-md transition text-sm";
								button.onclick = () => {
									document.getElementById("blog-title").value = title;
									titleSuggestions.innerHTML = "";
								};
								titleSuggestions.appendChild(button);
							});
						} catch (e) {
							console.error("Failed to parse title suggestions:", e);
							alert("The AI returned an unexpected format for titles.");
						}
					}
				}

				async function handleGeneratePost() {
					const title = document.getElementById("blog-title").value.trim();
					if (!title) {
						alert("Please enter a title for the blog post first.");
						return;
					}
					const prompt = `Write a comprehensive and engaging blog post based on the title: "${title}". The post should be well-structured with headings (using markdown #, ##, ###), paragraphs, and lists where appropriate. The tone should be informative and helpful.`;
					const result = await callGeminiAPI(prompt);

					if (result) {
						quill.clipboard.dangerouslyPasteHTML(
							0,
							simpleMarkdownToHtml(result)
						);
					}
				}

				const initializeQuillEditor = () => {
					if (!quill) {
						quill = new Quill("#editor-container", {
							theme: "snow",
							modules: {
								toolbar: [
									[{ header: [1, 2, 3, false] }],
									["bold", "italic", "underline"],
									[{ list: "ordered" }, { list: "bullet" }],
									["link"],
									["clean"],
								],
							},
							placeholder: "Start writing your amazing blog post here...",
						});
					}
				};

				const loadAnalytics = async () => {
					const response = await api.get("/analytics/visitors");
					if (!response.ok) return;
					const data = response.data;
					if (visitorsChart) visitorsChart.destroy();
					const ctx = document.getElementById("visitorsChart").getContext("2d");
					visitorsChart = new Chart(ctx, {
						type: "line",
						data: {
							labels: data.labels,
							datasets: [
								{
									label: "Unique Visitors",
									data: data.data,
									borderColor: "#3b82f6",
									tension: 0.1,
								},
							],
						},
						options: {
							responsive: true,
							maintainAspectRatio: false,
							scales: { y: { beginAtZero: true } },
						},
					});
				};

				const blogList = document.getElementById("blog-list");
				const blogForm = document.getElementById("blog-form");
				const blogFormTitle = document.getElementById("blog-form-title");
				const blogSubmitButton = document.getElementById("blog-submit-button");
				const blogCancelButton = document.getElementById("blog-cancel-button");
				const blogIdInput = document.getElementById("blog-id");
				const blogTitleInput = document.getElementById("blog-title");

				const loadBlogPosts = async () => {
					const response = await api.get("/blogs");
					if (!response.ok) return;
					const posts = response.data;
					blogList.innerHTML = "";
					posts.forEach((post) => {
						const row = document.createElement("tr");
						row.innerHTML = `
                        <td class="p-2 border-b">${post.title}</td>
                        <td class="p-2 border-b hidden sm:table-cell">${new Date(
													post.created_at
												).toLocaleDateString()}</td>
                        <td class="p-2 border-b space-x-2">
                            <button data-id="${
															post.id
														}" class="edit-post-btn text-blue-500 hover:underline">Edit</button>
                            <button data-id="${
															post.id
														}" class="delete-post-btn text-red-500 hover:underline">Delete</button>
                        </td>`;
						blogList.appendChild(row);
					});
				};

				const resetBlogForm = () => {
					blogForm.reset();
					quill.root.innerHTML = "";
					blogIdInput.value = "";
					blogFormTitle.textContent = "Write a New Blog Post";
					blogSubmitButton.textContent = "Publish Post";
					blogCancelButton.classList.add("hidden");
				};

				const setupBlogForm = () => {
					blogForm.addEventListener("submit", async (e) => {
						e.preventDefault();
						const id = blogIdInput.value;
						const title = blogTitleInput.value;
						const content = quill.root.innerHTML;
						const isUpdating = !!id;
						const response = isUpdating
							? await api.put(`/blogs/${id}`, { title, content })
							: await api.post("/blogs", { title, content });

						if (response.ok) {
							resetBlogForm();
							loadBlogPosts();
						} else {
							alert(`Error: ${response.data.msg || "Failed to save post."}`);
						}
					});
					blogCancelButton.addEventListener("click", resetBlogForm);
				};

				blogList.addEventListener("click", async (e) => {
					const target = e.target;
					const id = target.dataset.id;
					if (target.classList.contains("delete-post-btn")) {
						if (confirm("Are you sure you want to delete this post?")) {
							await api.del(`/blogs/${id}`);
							loadBlogPosts();
						}
					} else if (target.classList.contains("edit-post-btn")) {
						const response = await api.get(`/blogs/${id}`);
						if (response.ok) {
							const post = response.data;
							blogIdInput.value = post.id;
							blogTitleInput.value = post.title;
							quill.root.innerHTML = post.content;
							blogFormTitle.textContent = "Edit Blog Post";
							blogSubmitButton.textContent = "Update Post";
							blogCancelButton.classList.remove("hidden");
							blogForm.scrollIntoView({ behavior: "smooth" });
						}
					}
				});

				const imageUploadForm = document.getElementById("imageUploadForm");
				const mediaGrid = document.getElementById("media-grid");
				const imageFileInput = document.getElementById("imageFileInput");
				const imagePreviewContainer = document.getElementById(
					"imagePreviewContainer"
				);
				const imagePreview = document.getElementById("imagePreview");
				const imagePreviewPlaceholder = document.getElementById(
					"imagePreviewPlaceholder"
				);
				const uploadButton = document.getElementById("upload-button");

				const loadMediaGallery = async () => {
					const response = await api.get("/gallery");
					if (!response.ok) {
						console.error("Failed to load media gallery:", response.data);
						return;
					}
					mediaGrid.innerHTML = "";
					response.data.data.forEach((item) => {
						const div = document.createElement("div");
						div.className = "relative group";
						div.innerHTML = `
                        <img src="${item.url}" alt="${item.public_id}" class="w-full h-48 object-cover rounded-lg shadow-md">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex items-center justify-center rounded-lg">
                            <button data-id="${item.public_id}" class="delete-media-btn opacity-0 group-hover:opacity-100 bg-red-500 text-white py-2 px-4 rounded-lg transition-opacity">Delete</button>
                        </div>
                        <p class="text-xs text-gray-600 truncate mt-1">${item.public_id}</p>
                    `;
						mediaGrid.appendChild(div);
					});
				};

				const setupMediaManagement = () => {
					imagePreviewContainer.addEventListener("click", () =>
						imageFileInput.click()
					);
					imageFileInput.addEventListener("change", (e) => {
						const file = e.target.files[0];
						if (file) {
							const reader = new FileReader();
							reader.onload = (event) => {
								imagePreview.src = event.target.result;
								imagePreview.classList.remove("hidden");
								imagePreviewPlaceholder.classList.add("hidden");
							};
							reader.readAsDataURL(file);
							uploadButton.classList.remove("hidden");
						}
					});

					imageUploadForm.addEventListener("submit", async (e) => {
						e.preventDefault();
						const formData = new FormData(imageUploadForm);
						const response = await api.upload("/gallery/upload", formData);
						if (response.ok) {
							alert("Image uploaded successfully!");
							imageUploadForm.reset();
							imagePreview.classList.add("hidden");
							imagePreviewPlaceholder.classList.remove("hidden");
							uploadButton.classList.add("hidden");
							loadMediaGallery();
						} else {
							alert(`Upload failed: ${response.data.msg}`);
						}
					});

					mediaGrid.addEventListener("click", async (e) => {
						if (e.target.classList.contains("delete-media-btn")) {
							const public_id = e.target.dataset.id;
							if (
								confirm(`Are you sure you want to delete image: ${public_id}?`)
							) {
								const response = await api.del(`/gallery/${public_id}`);
								if (response.ok) {
									alert("Image deleted successfully!");
									loadMediaGallery();
								} else {
									alert(`Failed to delete image: ${response.data.msg}`);
								}
							}
						}
					});
				};

				const setupNavigation = () => {
					const links = document.querySelectorAll(".sidebar-link");
					const panels = document.querySelectorAll(".content-panel");
					const pageTitle = document.getElementById("page-title");
					links.forEach((link) => {
						link.addEventListener("click", (e) => {
							e.preventDefault();
							const targetId =
								link.getAttribute("href").substring(1) + "-content";

							links.forEach((l) => l.classList.remove("active"));
							link.classList.add("active");

							panels.forEach((p) => p.classList.add("hidden"));
							document.getElementById(targetId).classList.remove("hidden");

							pageTitle.textContent = link.textContent.trim();

							if (window.innerWidth < 1024) {
								sidebar.classList.remove("open");
								overlay.classList.remove("active");
							}
						});
					});
				};

				// --- Initial Check ---
				// auth.check(); // Original authentication check is disabled for testing.
				auth.showDashboard(); // Directly show the dashboard to bypass login for testing in Canvas.
			});
		</script>
	</body>
</html>
